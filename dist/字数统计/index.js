const e=/<([^>/\s]+)(?:\s+[^>]*)?>[\s\S]*?<\/\1>/g,t=/<([^>/\s]+)(?:\s+[^>]*)?\/>/g,n=/<maintext(?:\s+[^>]*)?>[\s\S]*?<\/maintext>/g;function s(s){const r=Number(s),a=$(`.mes[mesid="${r}"]`);if(0===a.length)return;const c=a.find('.tokenCounterDisplay');if(0===c.length)return;const i=c.text().match(/(\d+)t/);if(!i)return;const l=getChatMessages(r);if(!l||0===l.length)return;let o=l[0].message||'';o=o.replace(e,''),o=o.replace(t,''),o=o.replace(n,'');const g=o.length;let m=0;{let n=l[0].extra?.reasoning||'';n=n.replace(e,''),n=n.replace(t,''),m=n.length}const u=i[1],E=m>0?`${u}t(${m}+${g})`:`${u}t(${g})`;c.text(E)}$(()=>{eventOn(tavern_events.MESSAGE_RECEIVED,e=>{setTimeout(()=>s(Number(e)),200)}),eventOn(tavern_events.MESSAGE_UPDATED,e=>{setTimeout(()=>s(Number(e)),200)}),eventOn(tavern_events.STREAM_REASONING_DONE,(_,e,t)=>{setTimeout(()=>s(t),200)})});
//# sourceMappingURL=index.js.map